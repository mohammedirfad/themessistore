(function(){"use strict";var PFUrlParser={baseUrl:"https://www.printful.com",appName:"printful",getCurrentUrl:function(){var currentUrl="";if(document.currentScript){currentUrl=document.currentScript.src}else{var script=document.getElementsByTagName("script");for(var i=0;i<script.length;i++){var pattern=/shopify-product-customizer.js/i;if(pattern.test(script[i].src)){currentUrl=script[i].src;break}}}var questionMarkIndex=currentUrl.indexOf("?");if(questionMarkIndex>0){currentUrl=currentUrl.substring(0,questionMarkIndex)}if(currentUrl){if(currentUrl.indexOf(this.appName)==-1||currentUrl.indexOf("cdn.printful.com")!==-1){return this.baseUrl}var protocol="http://";if(currentUrl.indexOf("http://")==0){currentUrl=currentUrl.replace("http://","")}if(currentUrl.indexOf("https://")==0){currentUrl=currentUrl.replace("https://","");protocol="https://"}if(currentUrl.indexOf("//")==0){currentUrl=currentUrl.replace("//","");protocol="https://"}var firstPart=currentUrl.split("/").shift();if(firstPart){this.baseUrl=protocol+firstPart}}return this.baseUrl}};var PFProductCustomizeProductLang={currentLocale:null,translations:{"Personalize design":{es:"Personalizar diseño",fr:"Personnaliser le design",de:"Design personalisieren",it:"Personalizza le grafiche",ja:"デザインをカスタマイズ"},"Create a personalized design":{es:"Crear diseño personalizado",fr:"Créer un design personnalisé",de:"Erstelle ein personalisiertes Design",it:"Crea grafiche personalizzate",ja:"カスタムデザインを追加"}},translate:function(original){if(!this.currentLocale&&document&&document.documentElement){this.currentLocale=document.documentElement.lang}this.currentLocale=this.currentLocale?this.currentLocale:"en";if(this.translations[original]&&this.translations[original][this.currentLocale]){return this.translations[original][this.currentLocale]}return original}};var PFProductCustomize={settings:{baseUrl:"https://www.printful.com",buttonText:PFProductCustomizeProductLang.translate("Personalize design")},storeUrl:null,form:null,modal:null,submitBtn:null,customizeButton:null,init:function(){this.settings.baseUrl=PFUrlParser.getCurrentUrl();this.settings.iframeUrl=this.settings.baseUrl+"/product-customizer/";this.storeUrl=typeof Shopify.shop!=="undefined"?Shopify.shop:null;var formList=document.querySelectorAll('form[action$="/cart/add"]');if(formList.length===0){console.log("Valid checkout form not found");return}this.form=Array.from(formList).find(function(form){var submitButtonList=form.querySelectorAll('[type="submit"]');if(submitButtonList.length>0){return form}});if(!this.form){console.log("Add to cart button missing on form");return}var submitBtnList=this.form.querySelectorAll('[type="submit"]');if(submitBtnList.length>0){this.submitBtn=submitBtnList[0]}if(this.buttonExists()){this.customizeButton=this.getButton();this.initButtonEvents()}else if(document.querySelector(".pf-customisable-product")){this.insertButton();this.initButtonEvents()}},insertButton:function(){this.customizeButton=this.createButton();this.submitBtn.parentNode.insertBefore(this.customizeButton,this.submitBtn.nextSibling)},initButtonEvents:function(){this.customizeButton.onclick=this.onCustomizeClick.bind(this);if(this.submitBtn){this.customizeButton.disabled=this.submitBtn.disabled}this.form.addEventListener("change",function(e){if(["SELECT","INPUT"].indexOf(e.target.tagName.toUpperCase()!==-1)){setTimeout(function(){this.customizeButton.disabled=this.submitBtn.disabled}.bind(this),40)}}.bind(this),false)},getButton:function(){return document.getElementById("pfCustomizeProductBtn")},buttonExists:function(){return!!this.getButton()},createButton:function(){var customizeButton=document.createElement("button");customizeButton.innerText=this.settings.buttonText;customizeButton.setAttribute("class","btn button");customizeButton.setAttribute("style","margin: 5px 0;");customizeButton.setAttribute("id","pfCustomizeProductBtn");return customizeButton},onCustomizeClick:function(event){event.preventDefault();var variant=false;var variantSelect=this.form.querySelectorAll('select[name="id"]');if(variantSelect.length>0){variant=variantSelect[0].options[variantSelect[0].selectedIndex].value}else{var variantInput=this.form.querySelectorAll('input[name="id"]');if(variantInput.length==0){return}variant=variantInput[0].value}if(!variant){return}var url=this.settings.iframeUrl+"?store="+this.storeUrl+"&variant="+variant;document.body.appendChild(this.createModal(url));this.listenForResponse()},listenForResponse:function(){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod==="attachEvent"?"onmessage":"message";eventer(messageEvent,function(e){if(e.origin!==this.settings.baseUrl){return}if(typeof e.data["action"]==="undefined"||e.data["action"]!=="PFProductCustomized"){return}this.onCustomDesignSave(e.data["hash"])}.bind(this))},onCustomDesignSave:function(hash){if(hash){var customisationFieldList=this.form.querySelectorAll('[name="properties[customisationId]"]');var customisationField;if(customisationFieldList.length>0){customisationField=customisationFieldList[0]}else{customisationField=document.createElement("input");customisationField.type="hidden";customisationField.name="properties[customisationId]";this.form.appendChild(customisationField)}customisationField.value=hash}this.form.submit()},createModal:function(url){this.closeModal();var isMobileSafari=false;var userAgent=window.navigator&&window.navigator.userAgent?window.navigator.userAgent:false;if(userAgent&&userAgent.match(/iPhone|iPad|iPod/i)){isMobileSafari=true}var modal=document.createElement("div");modal.className="pf-customize-modal";modal.setAttribute("style","position: fixed; z-index: 2147483648; padding: 20px; top: 0; width: 100%; height: 100%; left: 0; background: rgba(0, 0 , 0, 0.6); box-sizing: border-box;");var modalHeader=document.createElement("div");modalHeader.setAttribute("style","padding: 15px; border-bottom: 1px solid #e5e5e5; overflow:hidden; position:absolute; top:0; left:0; width:100%; box-sizing: border-box;");var closeBtn=document.createElement("button");closeBtn.onclick=this.closeModal.bind(this);closeBtn.setAttribute("style","height:30px; width:30px; cursor:pointer; border:0px; background:0 0; padding:0; -webkit-appearance:none; color:#000; float:right; background:none;");var closeImg=document.createElement("img");closeImg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAgVJREFUaAXtmU2KwkAQhZ0hQbyDu7mIB3PhwoN5EXfeIYguJo9JQRMydurnNYxTDTH+dNWr71VD2mSzyZEOpAPpQDqQDqQD6UA6kA6kA80dOJ1O++Px+NVKGFrQ9Oh9WoMhPAzD5fF4XFpAQwNa0PRAf1iABXaMle7e+r4/nM/nqyVfLUZgx3nS3etutzuMddxqsfPf1cALsJKTAr0AK3omaPWSfj6f21ERx3zso5f3C1hob6da5nW8/KzuMLJVCgnpNEvDBMyGZsGibjMwC5oJ6waOhmbDhgBHQbeADQP2QreCDQW2QreEDQfWQreGpQCvhcY8bFTGk2wX8ZWMkGu5JCvPrstSmWj+vta9aX5TWGjSgJG8Ao0p80HrrAhRgSGigKbDoh468EroJrCoRf1vCUF/edA7/K+WtAJWFg19adM6XIGVWzPvcVmqweL+F1r6FhuPNbBys08zV9a89xy6pC0AlhgPdBiwp3BPrBY+BDii4Igca+DdwJGFRub6Dd4FzCiQkbOENwMzC2PmNgEzC5JusDTUwKxCBLQ8M7TU/5a6rruPReGYj/B9MDYo065MtqKl5n2qpfyu+l7dYWRceIIYDltWvtBp05ND5DQBI7CA3jKfDUMLo4C+W58N/2RyvAIahThSqEKhBU1VUE5OB9KBdCAdSAfSgXQgHUgH0oEQB74BG1sUIwNoL3cAAAAASUVORK5CYII=";closeImg.setAttribute("style","height:30px; width:30px;");closeBtn.appendChild(closeImg);modalHeader.appendChild(closeBtn);var modalHeaderTitle=document.createElement("h4");modalHeaderTitle.className="product-customizer__header-title";modalHeaderTitle.setAttribute("style","float: left;font-weight:bold;font-size:23px;color:#222;line-height:30px;margin:0px;");modalHeaderTitle.innerText=PFProductCustomizeProductLang.translate("Create a personalized design");modalHeader.appendChild(modalHeaderTitle);var modalContent=document.createElement("div");modalContent.setAttribute("style","background-color: #fff; width: 100%; height: 100%;overflow:hidden;position:relative");modalContent.appendChild(modalHeader);var styles=document.createElement("style");styles.innerHTML="@media screen and (max-width: 768px) { .product-customizer__header-title {font-size: 16px !important;} }";modalContent.appendChild(styles);modal.appendChild(modalContent);var iframe=document.createElement("iframe");iframe.src=url;iframe.width="100%";iframe.height="100%";if(isMobileSafari){var iframeWrapper=document.createElement("div");iframeWrapper.setAttribute("style","-webkit-overflow-scrolling: touch; overflow: scroll; height: 100%; top: 61px; box-sizing: border-box; position: absolute; width: 100%; padding-bottom: 60px;");iframe.setAttribute("style","border: 0; box-sizing: border-box;");iframeWrapper.appendChild(iframe);modalContent.appendChild(iframeWrapper)}else{iframe.setAttribute("style","border: 0; padding-top: 60px; box-sizing: border-box;");modalContent.appendChild(iframe)}this.modal=modal;return modal},closeModal:function(){if(this.modal){this.modal.parentNode.removeChild(this.modal);this.modal=null}}};PFProductCustomize.init();var PFCustomizedProductCartManager={settings:{baseUrl:"https://www.printful.com"},_customizeKeyStrings:["customisationId:","customisationId"],init:function(){this.settings.baseUrl=PFUrlParser.getCurrentUrl();this._processCustomizedImages();var that=this;var observer=new MutationObserver(function(mutations){mutations.forEach(function(){that._processCustomizedImages()})});var observerConfig={childList:true,subtree:true};observer.observe(document.body,observerConfig)},_processCustomizedImages:function(){var forms=document.querySelectorAll('form[action="/cart"]');this._replaceImagesInElement(forms)},_replaceImagesInElement:function(elements){for(var i=0;i<elements.length;i++){var form=elements[i];if(!form.classList.contains("pf-form-processed")){form.classList.add("pf-form-processed");this._parseElement(form)}}},_parseElement:function(element){var childNodes=element.childNodes;for(var i=0;i<childNodes.length;i++){var childElement=childNodes[i];if(childElement.nodeType==Node.TEXT_NODE){this._findAndRemoveCustomizeKeyInfo(childElement)}else{this._parseElement(childElement)}}},_findAndRemoveCustomizeKeyInfo:function(node){for(var i=0;i<this._customizeKeyStrings.length;i++){var customizeString=this._customizeKeyStrings[i];if(node.textContent.indexOf(customizeString)!=-1){node.textContent=node.textContent.replace(customizeString,"")}}if(node.textContent.indexOf("pfc_")!=-1){var prefixIndex=node.textContent.indexOf("pfc_");var hashWithPrefix=node.textContent.substring(prefixIndex,prefixIndex+32+4);var hash=hashWithPrefix.substring(4,32+4);node.textContent=node.textContent.replace(hashWithPrefix,"");this._findAndReplaceImage(node.parentNode,this.settings.baseUrl+PFCustomizedProductCartManager.LOADING_IMAGE_URL,true);this._findAndReplaceLinkImage(node.parentNode,this.settings.baseUrl+PFCustomizedProductCartManager.LOADING_IMAGE_URL,true);this._getImageForHash(hash,node);if(node.parentNode.textContent.trim().length==0&&node.parentNode.tagName){node.parentNode.style.display="none"}}},_getImageForHash:function(hash,node){var request=new XMLHttpRequest;request.onreadystatechange=function(node,hash,parent){if(this.readyState==4&&this.status==200){var response=JSON.parse(this.responseText);var image=response.result.image;if(!image){setTimeout(function(){parent._getImageForHash(hash,node)},2e3)}else{parent._findAndReplaceImage(node.parentNode,image,true);parent._findAndReplaceLinkImage(node.parentNode,image,true)}}}.bind(request,node,hash,this);var url=this.settings.baseUrl+"/rpc/product-customizer-rpc/get-thumb";request.open("POST",url,true);request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");request.send("hash="+hash)},_findAndReplaceImage:function(node,imageUrl,scanParent){return this._findAndReplaceLoop(node,imageUrl,scanParent,function(childElement,imageUrl){if(childElement.tagName=="IMG"){childElement.src=imageUrl;childElement.setAttribute("data-widths","[800]");childElement.setAttribute("data-srcset",imageUrl+" 800w");childElement.setAttribute("srcset",imageUrl+" 800w");return true}return false})},_findAndReplaceLinkImage:function(node,imageUrl,scanParent){return this._findAndReplaceLoop(node,imageUrl,scanParent,function(childElement,imageUrl){if(childElement.tagName=="A"&&childElement.style.backgroundImage.length>0){childElement.style.backgroundImage="url("+imageUrl+")";return true}return false})},_findAndReplaceLoop:function(node,imageUrl,scanParent,replaceCallback){if(!node){return false}if(node.classList.contains("pf-form-processed")){console.warn("Looks like image was not replaced");return true}for(var i=0;i<node.children.length;i++){var childElement=node.children[i];if(replaceCallback(childElement,imageUrl)){return true}if(this._findAndReplaceLoop(childElement,imageUrl,false,replaceCallback)){return true}}if(scanParent){return this._findAndReplaceLoop(node.parentNode,imageUrl,true,replaceCallback)}return false}};PFCustomizedProductCartManager.LOADING_IMAGE_URL="/static/images/product-customizer/loading.gif";PFCustomizedProductCartManager.init();var edt={settings:{baseUrl:"https://api.printful.com"},form:null,init:function(){var currentUrl=PFUrlParser.getCurrentUrl();this.settings.baseUrl=currentUrl.replace("www.","api.");this.storeUrl=typeof Shopify.shop!=="undefined"?Shopify.shop:null;var formList=document.querySelectorAll('form[action$="/cart/add"]');if(formList.length===0){return}this.form=Array.from(formList).find(function(form){var submitButtonList=form.querySelectorAll('[type="submit"]');if(submitButtonList.length>0){return form}var fallbackClassesList=form.querySelectorAll('[class*="add-to-cart"], [class*="cart-submit"], [class*="form__submit"], [class*="submit"]');if(fallbackClassesList.length>0){return form}});this.getEdt()},buildEdtDiv:function(response){var edtDiv=document.createElement("div");edtDiv.classList.add("edt");edtDiv.style.width="100%";edtDiv.style.textAlign="center";edtDiv.style.marginTop="8px";edtDiv.style.padding="0 8px";var textAlignments={0:"center",1:"left",2:"right"};if(typeof pfEdtUseDefaultStyling!=="undefined"){if(!pfEdtUseDefaultStyling){if(typeof pfEdtTextColor!=="undefined"){edtDiv.style.color=pfEdtTextColor}if(typeof pfEdtBackgroundColor!=="undefined"){edtDiv.style.backgroundColor=pfEdtBackgroundColor}if(typeof pfEdtBorderColor!=="undefined"){edtDiv.style.border="1px solid "+pfEdtBorderColor}if(typeof pfEdtTextAlignment!=="undefined"){edtDiv.style.textAlign=textAlignments[pfEdtTextAlignment]}}else{var paragraph=document.querySelector("p");if(paragraph){edtDiv.style.color=paragraph.style.color}}}if(pfEdtFlags[response.result.countryCode]){edtDiv.innerHTML=response.result.html.replace("{img}",'<img src="'+pfEdtFlags[response.result.countryCode]+'" style="height: 1em; width: 1.5em; margin-bottom: -0.125em;">')}else{edtDiv.innerHTML=response.result.html.replace("{img}","")}return edtDiv},getEdt:function(){if(typeof pfEdt==="undefined"){return}if(!pfEdt){return}try{var response=localStorage.getItem(Shopify.locale+"_"+pfProductId);if(response){var cached=Number(localStorage.getItem(Shopify.locale+"_edtCached_"+pfProductId));if(Date.now()-4*60*60*1e3<cached){response=JSON.parse(response);if(response.result&&response.result.html){var edtDiv=this.buildEdtDiv(response);this.form.appendChild(edtDiv)}return}}}catch(e){}var request=new XMLHttpRequest;request.onreadystatechange=function(parent){if(this.readyState==4&&this.status==200){var response=JSON.parse(this.responseText);if(!response.result){return}if(!response.result.is_success&&response.result.reason_code=="internal_server_error"){console.log(response.result.reason);return}try{localStorage.setItem(Shopify.locale+"_"+pfProductId,this.responseText);localStorage.setItem(Shopify.locale+"_edtCached_"+pfProductId,Date.now().toString())}catch(e){}if(response.result&&response.result.html){var edtDiv=parent.buildEdtDiv(response);parent.form.appendChild(edtDiv)}}}.bind(request,this);if(typeof pfProductId==="undefined"){return}if(typeof pfProductId==="object"){return}if(!pfProductId){return}var url=this.settings.baseUrl+"/estimate-delivery-time?productId="+pfProductId+"&locale="+Shopify.locale;request.open("GET",url,true);request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8");request.send()}};edt.init()})();